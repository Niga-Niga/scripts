getgenv().Config = {
    ["Auto Game"] = {
        ["Rarity"] = {
            ["Enable"] = false,
            ["Name Rarity"] = {"Mythic","Secret"},
        },
        ["Name"] = {
            ["Enable"] = true,
            ["Name Brainrot"] = {"Bananita Dolphinita","Chocco Bunny"},
        }
    },
    ["Account Main"] = {"dopro0","Dopro0"},
    ["Max slot"] = 10
}

local Players = game:GetService("Players")
local PathfindingService = game:GetService("PathfindingService")
local ProximityPromptService = game:GetService("ProximityPromptService")

local lp = Players.LocalPlayer
local char = lp.Character or lp.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")
local hrp = char:WaitForChild("HumanoidRootPart")

local CFG = getgenv().Config
local Plots = workspace:WaitForChild("Plots")

local function isMain()
    for _,v in ipairs(CFG["Account Main"]) do
        if lp.Name == v then
            return true
        end
    end
end

if not isMain() then
    lp:Kick("Not main account")
end

local function scanPlot(plot)
    local pods = plot:FindFirstChild("AnimalPodiums")
    if not pods then return 0,0,{} end

    local occupied,max,list = 0,0,{}
    for _,s in ipairs(pods:GetChildren()) do
        local n = tonumber(s.Name)
        if n and n > max then max = n end

        local spawn = s:FindFirstChild("Base")
            and s.Base:FindFirstChild("Spawn")

        if spawn then
            local att = spawn:FindFirstChild("Attachment")
            local oh = att and att:FindFirstChild("AnimalOverhead")
            local dn = oh and oh:FindFirstChild("DisplayName")
            local rr = oh and oh:FindFirstChild("Rarity")

            if dn and rr then
                occupied += 1
            end

            local pa = spawn:FindFirstChild("PromptAttachment")
            local stealPrompt
            if pa then
                for _,p in ipairs(pa:GetChildren()) do
                    if p:IsA("ProximityPrompt") and p.ActionText == "Steal" then
                        stealPrompt = p
                        break
                    end
                end
            end

            if dn and rr and stealPrompt then
                list[#list+1] = {
                    Pod = s,
                    Name = dn.Text,
                    Rarity = rr.Text,
                    Prompt = stealPrompt,
                    Position = s:GetPivot().Position
                }
            end
        end
    end
    return occupied,max,list
end

local function getMyPlot()
    for _,p in ipairs(Plots:GetChildren()) do
        local yb = p:FindFirstChild("PlotSign")
            and p.PlotSign:FindFirstChild("YourBase")
        if yb and yb.Enabled then
            return p
        end
    end
end

local myPlot = getMyPlot()
if not myPlot then
    lp:Kick("Base not found")
end

local function walkTo(pos)
    local path = PathfindingService:CreatePath({
        AgentRadius = 2,
        AgentHeight = 5,
        AgentCanJump = true
    })
    path:ComputeAsync(hrp.Position,pos)
    if path.Status ~= Enum.PathStatus.Success then return false end
    for _,wp in ipairs(path:GetWaypoints()) do
        hum:MoveTo(wp.Position)
        hum.MoveToFinished:Wait()
    end
    return true
end

local function backToBase()
    walkTo(myPlot:GetPivot().Position)
end

local function nameMatch(n)
    for _,v in ipairs(CFG["Auto Game"]["Name"]["Name Brainrot"]) do
        if n == v then return true end
    end
end

local function rarityMatch(r)
    for _,v in ipairs(CFG["Auto Game"]["Rarity"]["Name Rarity"]) do
        if r == v then return true end
    end
end

local function findTarget()
    for _,p in ipairs(Plots:GetChildren()) do
        local _,_,list = scanPlot(p)
        for _,info in ipairs(list) do
            if CFG["Auto Game"]["Name"]["Enable"] and nameMatch(info.Name) then
                return info
            end
            if CFG["Auto Game"]["Rarity"]["Enable"] and rarityMatch(info.Rarity) then
                return info
            end
        end
    end
end

local function waitPrompt(prompt)
    local shown = false
    local conn = ProximityPromptService.PromptShown:Connect(function(p)
        if p == prompt then
            shown = true
        end
    end)

    local t = os.clock()
    while not shown and os.clock() - t < 3 do
        task.wait()
    end
    conn:Disconnect()
    return shown
end

local function fireSteal(prompt)
    if not waitPrompt(prompt) then return end
    for i=1,6 do
        pcall(function()
            fireproximityprompt(prompt)
        end)
        task.wait(0.05)
    end
end

while true do
    local occupied = select(1, scanPlot(myPlot))
    if occupied >= CFG["Max slot"] then
        print("Max slot")
    end

    local target = findTarget()
    if not target then
      print("No target")
    end

    walkTo(target.Position)
    task.wait(0.1)
    fireSteal(target.Prompt)
    task.wait(0.2)
    backToBase()
    task.wait(0.4)
end
